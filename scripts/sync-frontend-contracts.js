const fs = require("fs");
const path = require("path");

function main() {
  const deploymentPath = path.join(__dirname, "..", "deployments", "sepolia", "OblivionChat.json");
  if (!fs.existsSync(deploymentPath)) {
    throw new Error(`Missing deployment file: ${deploymentPath}`);
  }

  const deployment = JSON.parse(fs.readFileSync(deploymentPath, "utf8"));
  const address = deployment.address;
  const abi = deployment.abi;

  if (!address || typeof address !== "string") throw new Error("Deployment is missing address");
  if (!Array.isArray(abi)) throw new Error("Deployment is missing abi");

  const outPath = path.join(__dirname, "..", "src", "src", "config", "contracts.ts");
  const out = `// This file is generated by scripts/sync-frontend-contracts.js\n` +
    `// Source: deployments/sepolia/OblivionChat.json\n` +
    `export const OBLIVION_CHAT_ADDRESS = ${JSON.stringify(address)} as const;\n\n` +
    `export const OBLIVION_CHAT_ABI = ${JSON.stringify(abi, null, 2)} as const;\n`;

  fs.writeFileSync(outPath, out, "utf8");
  console.log(`Wrote ${outPath}`);
}

main();

